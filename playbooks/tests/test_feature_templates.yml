# Copyright 2024 Cisco Systems, Inc. and its affiliates
# GNU General Public License v3.0+ (see LICENSE or https://www.gnu.org/licenses/gpl-3.0.txt)

---

# Helper playbooks to test modules and flows while developing them

# Tested operations:

# --- Feature Templates creation --- #


- name: Testing playbook to verify cisco.catalystwan.feature_template module operations
  hosts: localhost
  gather_facts: false
  vars_files:
    - configuration_file_dev_vars.yml
  vars:
    manager_authentication: &manager_authentication
      url: "{{ (vmanage_instances | first).mgmt_public_ip }}"
      username: "{{ (vmanage_instances | first).admin_username }}"
      password: "{{ (vmanage_instances | first).admin_password }}"
  tasks:
    - name: Get all Non-Default Feature Templates available
      cisco.catalystwan.feature_templates_info:
        filters:
          factory_default: false
        manager_credentials:
          <<: *manager_authentication
      register: feature_templates

    - name: Delete all Non-Default Feature templates
      cisco.catalystwan.feature_templates:
        state: absent
        template_name: "{{ template.templateName }}"
        manager_credentials:
          <<: *manager_authentication
      loop: "{{ feature_templates.templates_info | default([], true) }}"
      loop_control:
        loop_var: template
        label: "template: {{ template.templateName }}"

    # vedge-C8000V templates

    # - name: "Create Comprehensive AAA Template with TACACS+ and RADIUS"
    #   cisco.catalystwan.feature_templates:
    #     state: present
    #     template_name: "ComprehensiveAAATemplate"
    #     template_description: "AAA Template with both TACACS+ and RADIUS servers"
    #     debug: true
    #     device_models:
    #       - vedge-C8000V
    #     cisco_aaa:
    #       user:
    #         - name: "local_admin"
    #           password: "admin_password"
    #           secret: "admin_secret"
    #           privilege: "15"
    #           pubkey_chain:
    #             - key_string: "AAAAB3NzaC1yc2EAAAADAQABAAABAQC3myRj5L6ZFLdRnOEZdUd+4Qq0XPLW9RfO6qD7DJ2t4ZzLh6Oz+IUJg8d8bJDfxO9zGKs5uUQ9f2H5yTGX5G8Z5kKp8QDp1MkDVqwGJ4UM7JqH8s8kD7xcl8SyPc5TjzK4s4W+8LPNOPXmIKtHh1Qlvkp5N7w3M/Rm5ZVX5/3+Hk8Ib5syigQQd/5u5xJj9k3i2x3m3LZ7v5e7YlCpRdCQGf6ZCwvbVQHdJp5nlU0HxJbqjOTL4IcDj09G3Dq2C5JnohKJb7E7HVCUl7F5vYpC/4iNjges65GgdzaFJsT9qA8CgxyF+7J3PpLk5qPAQDT5OjArJj4x9Bw3j3lZdH example@example.com"
    #               key_type: "ssh-rsa"
    #       authentication_group: true
    #       accounting_group: true
    #       radius:
    #         - group_name: "radius_group1"
    #           vpn: "1"
    #           source_interface: "GigabitEthernet0/0"
    #           server:
    #             - address: "192.0.2.1"
    #               auth_port: 1812
    #               acct_port: 1813
    #               timeout: 5
    #               retransmit: 3
    #               key: "secure_radius_server_key"
    #               secret_key: "radius_secret"
    #               key_enum: "key_enum_value"
    #               key_type: "key_type_value"
    #       domain_stripping: "right-to-left"
    #       port: 1234
    #       authentication_type: any
    #       server_auth_order: "local radius_group1 tacacs_group1"
    #       server_key_password: "secure_server_key_password"
    #       cts_authorization_list: "example_element"
    #       radius_trustsec_group: "radius_group1"
    #       radius_client:
    #         - ip: 2.2.2.2
    #           vpn:
    #             - name: example_radius_client
    #               server_key: secure_radius_client_key
    #       accounting_rules:
    #         - rule_id: 0
    #           method: network
    #           level: "1"
    #           group: "radius_group1,tacacs_group1"
    #           start_stop: false
    #       authorization_console: true
    #       authorization_config_commands: true
    #       authorization_rules:
    #         - rule_id: 111
    #           method: commands
    #           group: "radius_group1,tacacs_group1"
    #           authenticated: true
    #       tacacs:
    #         - group_name: "tacacs_group1"
    #           vpn: 2
    #           source_interface: "GigabitEthernet0/1"
    #           server:
    #             - address: "192.0.2.2"
    #               port: 49
    #               timeout: 10
    #               key: "tacacs_key"
    #               secret_key: "tacacs_secret"
    #               key_enum: "key_enum_value" 
    #     manager_credentials:
    #       <<: *manager_authentication

    # - name: Create Cisco Banner Feature Template
    #   cisco.catalystwan.feature_templates:
    #     state: present
    #     template_name: "CiscoBannerConfigTemplate"
    #     template_description: "Banner configuration for login and MOTD"
    #     debug: true
    #     device_models:
    #       - "vedge-C8000V"
    #     cisco_banner:
    #       login_banner: |
    #         ****************************************************************
    #         * Unauthorized access to this device is prohibited.            *
    #         * You must have explicit permission to access or configure this *
    #         * device. All activities performed on this device are logged and *
    #         * violations of this policy may result in disciplinary action,   *
    #         * and may be reported to law enforcement. There is no right to  *
    #         * privacy on this device. Use of this system constitutes consent *
    #         * to monitoring for these purposes.                             *
    #         ****************************************************************
    #       motd_banner: |
    #         ****************************************************************
    #         * Welcome to Company XYZ Network!                              *
    #         * All connections are monitored and recorded for audit purposes. *
    #         * Disconnect IMMEDIATELY if you are not an authorized user!     *
    #         ****************************************************************
    #     manager_credentials:
    #       <<: *manager_authentication

    # - name: Create Cisco BFD Feature Template
    #   cisco.catalystwan.feature_templates:
    #     state: present
    #     template_name: "CiscoBFDFeatureTemplate"
    #     template_description: "Comprehensive BFD configuration"
    #     debug: true
    #     device_models:
    #       - "vedge-C8000V"
    #     cisco_bfd:
    #       multiplier: "3"
    #       poll_interval: "500"
    #       default_dscp: "46"
    #       color:
    #         - color: "mpls"
    #           hello_interval: "200"
    #           multiplier: "4"
    #           pmtu_discovery: true
    #           dscp: "46"
    #         - color: "biz-internet"
    #           hello_interval: "300"
    #           multiplier: "5"
    #           pmtu_discovery: false
    #           dscp: "34"
    #         - color: "private1"
    #           hello_interval: "250"
    #           multiplier: "3"
    #           pmtu_discovery: true
    #           dscp: "26"
    #         - color: "custom3"
    #           hello_interval: "350"
    #           multiplier: "6"
    #           pmtu_discovery: true
    #           dscp: "18"
    #     manager_credentials:
    #       <<: *manager_authentication

    # - name: Configure Cisco Logging Feature Template
    #   cisco.catalystwan.feature_templates:
    #     state: present
    #     template_name: "CiscoLoggingFeatureTemplate"
    #     template_description: "Comprehensive Logging Configuration"
    #     debug: true
    #     device_models:
    #       - "vedge-C8000V"
    #     cisco_logging:
    #       enable: true
    #       size: "20"
    #       rotate: "5"
    #       tls_profile:
    #         - profile: "default_tls_profile"
    #           version: "TLSv1.2"
    #           auth_type: "Server"
    #           ciphersuite_list:
    #             - "ECDHE-ECDSA-AES256-GCM-SHA384"
    #             - "ECDHE-RSA-AES256-GCM-SHA384"
    #         - profile: "secure_tls_profile"
    #           version: "TLSv1.2"
    #           auth_type: "Mutual"
    #           ciphersuite_list:
    #             - "ECDHE-ECDSA-CHACHA20-POLY1305"
    #             - "ECDHE-RSA-CHACHA20-POLY1305"
    #       server:
    #         - name: "1.1.1.1"
    #           vpn: "10"
    #           source_interface: "GigabitEthernet0/0"
    #           priority: "debugging"
    #           enable_tls: true
    #           custom_profile: true
    #           profile: "default_tls_profile"
    #         - name: "log_server_2"
    #           vpn: "20"
    #           source_interface: "GigabitEthernet0/1"
    #           priority: "error"
    #           enable_tls: false
    #       ipv6_server:
    #         - name: "ipv6_log_server_1"
    #           vpn: "10"
    #           source_interface: "GigabitEthernet0/2"
    #           priority: "critical"
    #           enable_tls: true
    #           custom_profile: true
    #           profile: "secure_tls_profile"
    #         - name: "ipv6_log_server_2"
    #           vpn: "30"
    #           source_interface: "GigabitEthernet0/3"
    #           priority: "emergency"
    #           enable_tls: false
    #     manager_credentials:
    #       <<: *manager_authentication

    # - name: Configure Cisco NTP Feature Template
    #   cisco.catalystwan.feature_templates:
    #     state: present
    #     template_name: "CiscoNTPFeatureTemplate"
    #     template_description: "Comprehensive NTP Configuration"
    #     debug: true
    #     device_models:
    #       - "vedge-C8000V"
    #     cisco_ntp:
    #       server:
    #         - name: "0.pool.ntp.org"
    #           key: "1"
    #           vpn: "10"
    #           version: "4"
    #           source_interface: "GigabitEthernet0/0"
    #           prefer: true
    #         - name: "1.pool.ntp.org"
    #           key: "2"
    #           vpn: "20"
    #           version: "4"
    #           source_interface: "GigabitEthernet0/1"
    #           prefer: false
    #       authentication:
    #         - number: 1
    #           md5: "md5key1"
    #         - number: 2
    #           md5: "md5key2"
    #       trusted:
    #         - "1"
    #         - "2"
    #       enable: true
    #       stratum: "2"
    #       source: "Loopback0"
    #     manager_credentials:
    #       <<: *manager_authentication

    # - name: Configure Cisco OMP Feature Template
    #   cisco.catalystwan.feature_templates:
    #     state: present
    #     template_name: "CiscoOMPFeatureTemplate"
    #     template_description: "Comprehensive OMP Configuration"
    #     debug: true
    #     device_models:
    #       - "vedge-C8000V"
    #     cisco_omp:
    #       graceful_restart: true
    #       overlay_as: "65000"
    #       send_path_limit: "10"
    #       ecmp_limit: "8"
    #       shutdown: false
    #       omp_admin_distance_ipv4: "110"
    #       omp_admin_distance_ipv6: "115"
    #       advertisement_interval: "30"
    #       graceful_restart_timer: "120"
    #       eor_timer: "300"
    #       holdtime: "180"
    #       advertise:
    #         - protocol: "bgp"
    #           route: "external"
    #         - protocol: "ospf"
    #         - protocol: "connected"
    #         - protocol: "static"
    #         - protocol: "eigrp"
    #         - protocol: "lisp"
    #       ipv6_advertise:
    #         - protocol: "bgp"
    #         - protocol: "ospf"
    #         - protocol: "connected"
    #         - protocol: "static"
    #       ignore_region_path_length: true
    #       transport_gateway: "prefer"
    #       site_types:
    #         - "type-1"
    #         - "type-2"
    #         - "cloud"
    #         - "branch"
    #         - "spoke"
    #       auto_translate: true
    #     manager_credentials:
    #       <<: *manager_authentication

    # - name: Configure Cisco OSPF Feature Template
    #   cisco.catalystwan.feature_templates:
    #     state: present
    #     template_name: "CiscoOSPFeatureTemplate"
    #     template_description: "Comprehensive OSPF Configuration"
    #     device_models:
    #       - "vedge-C8000V"
    #     cisco_ospf:
    #       router_id: "1.1.1.1"
    #       reference_bandwidth: "10000"
    #       rfc1583: false
    #       originate: true
    #       always: true
    #       metric: "10"
    #       metric_type: "type1"
    #       external: "20"
    #       inter_area: "30"
    #       intra_area: "40"
    #       delay: "5"
    #       initial_hold: "10"
    #       max_hold: "40"
    #       redistribute:
    #         - protocol: "static"
    #           route_policy: "static_policy"
    #           dia: true
    #         - protocol: "bgp"
    #           route_policy: "bgp_to_ospf_policy"
    #           dia: false
    #       router_lsa:
    #         - ad_type: "administrative"
    #           time: 10
    #       route_policy:
    #         - direction: "in"
    #           pol_name: "ospf_in_policy"
    #       area:
    #         - a_num: 0
    #           stub: false
    #           nssa: true
    #           interface:
    #             - name: "GigabitEthernet0/0"
    #               hello_interval: "10"
    #               dead_interval: "40"
    #               retransmit_interval: "5"
    #               cost: "1"
    #               priority: "1"
    #               network: "broadcast"
    #               passive_interface: false
    #               type: "simple"
    #               message_digest_key: "1"
    #               md5: "md5keystring"
    #           range:
    #             - address: "192.168.1.0/24"
    #               cost: "100"
    #               no_advertise: true
    #     manager_credentials:
    #         <<: *manager_authentication

    # - name: "Configure Secure Internet Gateway feature template"
    #   cisco.catalystwan.feature_templates:
    #     state: present
    #     template_name: "CiscoSecureInternetGatewayFeatureTemplate"
    #     template_description: "Comprehensive CiscoSecureInternetGateway Configuration"
    #     debug: true
    #     device_models:
    #       - "vedge-C8000V"
    #     cisco_secure_internet_gateway:
    #       vpn_id: 10
    #       child_org_id: "example_org"
    #       interface:
    #         - if_name: "GigabitEthernet0/0"
    #           auto: true
    #           shutdown: false
    #           description: "Main interface for SIG"
    #           unnumbered: false
    #           address: "192.168.1.1/24"
    #           tunnel_source: "192.168.1.1"
    #           tunnel_source_interface: "Loopback0"
    #           tunnel_route_via: "192.168.2.1"
    #           tunnel_destination: "203.0.113.1"
    #           application: "sig"
    #           tunnel_set: "secure-internet-gateway-umbrella"
    #           tunnel_dc_preference: "primary-dc"
    #           tcp_mss_adjust: "1400"
    #           mtu: 1400
    #           dpd_interval: "30"
    #           dpd_retries: "3"
    #           ike_version: 2
    #           pre_shared_secret: "MyPreSharedSecret"
    #           ike_rekey_interval: "3600"
    #           ike_ciphersuite: "aes256-cbc-sha1"
    #           ike_group: "14"
    #           pre_shared_key_dynamic: false
    #           ike_local_id: "local-id"
    #           ike_remote_id: "remote-id"
    #           ipsec_rekey_interval: "3600"
    #           ipsec_replay_window: "32"
    #           ipsec_ciphersuite: "aes256-gcm"
    #           perfect_forward_secrecy: "group-14"
    #           tracker: true
    #           track_enable: true
    #       service:
    #         - svc_type: "sig"
    #           interface_pair:
    #             - active_interface: "GigabitEthernet0/0"
    #               active_interface_weight: 10
    #               backup_interface: "GigabitEthernet0/1"
    #               backup_interface_weight: 5
    #           auth_required: "yes"
    #           xff_forward_enabled: "yes"
    #           ofw_enabled: "no"
    #           ips_control: "yes"
    #           caution_enabled: "no"
    #           primary_data_center: "Auto"
    #           secondary_data_center: "Auto"
    #           ip: "yes"
    #           idle_time: "30"
    #           display_time_unit: "MINUTE"
    #           ip_enforced_for_known_browsers: "yes"
    #           refresh_time: "5"
    #           refresh_time_unit: "MINUTE"
    #           enabled: "yes"
    #           block_internet_until_accepted: "no"
    #           force_ssl_inspection: "yes"
    #           timeout: "60"
    #           data_center_primary: "Auto"
    #           data_center_secondary: "Auto"
    #       tracker_src_ip: "192.0.2.1"
    #       tracker:
    #         - name: "health-check-tracker"
    #           endpoint_api_url: "https://api.example.com/health"
    #           threshold: "5"
    #           interval: "60"
    #           multiplier: "2"
    #           tracker_type: "SIG"
    #     manager_credentials:
    #       <<: *manager_authentication

    # - name: "Configure Cisco SNMP feature template"
    #   cisco.catalystwan.feature_templates:
    #     state: present
    #     template_name: "CiscoSNMPFeatureTemplate"
    #     template_description: "Comprehensive Cisco SNMP Configuration"
    #     cisco_snmp:
    #       shutdown: false
    #       contact: "SNMP Admin"
    #       location: "Data Center A"
    #       view:
    #         - name: "SystemView"
    #           oid:
    #             - id: "1.3.6.1.2.1.1"
    #               exclude: false
    #             - id: "1.3.6.1.2.1.2"
    #               exclude: true
    #         - name: "AllView"
    #           oid:
    #             - id: "1.3.6.1"
    #               exclude: false
    #       community:
    #         - name: "public"
    #           view: "SystemView"
    #           authorization: "read-only"
    #         - name: "private"
    #           view: "AllView"
    #           authorization: "read-only"
    #       group:
    #         - name: "v3group"
    #           security_level: "auth-priv"
    #           view: "AllView"
    #       user:
    #         - name: "snmpuser"
    #           auth: "md5"
    #           auth_password: "authpass"
    #           priv: "aes-cfb-128"
    #           priv_password: "privpass"
    #           group: "v3group"
    #       target:
    #         - vpn_id: 10
    #           ip: "192.0.2.50"
    #           port: 162
    #           community_name: "public"
    #           user: "snmpuser"
    #           source_interface: "GigabitEthernet0/0"
    #     manager_credentials:
    #       <<: *manager_authentication

    # - name: "Create Comprehensive Cisco System Template"
    #   cisco.catalystwan.feature_templates:
    #     state: present
    #     template_name: "ComprehensiveCiscoSystemTemplate"
    #     template_description: "Cisco System template"
    #     debug: true
    #     device_models:
    #       - "vedge-C8000V"
    #     cisco_system:
    #       timezone: "UTC"
    #       description: "Example desc"
    #       hostname:
    #         name: "sdwan-hostname"
    #       location: "Data Center A"
    #       latitude: "37.7749"
    #       longitude: "-122.4194"
    #       range: "10"
    #       enable_fencing: true
    #       mobile_number:
    #         - number: "+12345678901"
    #         - number: "+10987654321"
    #       enable_sms: true
    #       device_groups:
    #         - "group1"
    #         - "group2"
    #       controller_group_list:
    #         - 1
    #         - 3
    #       system_ip:
    #         name: "192.0.2.1"
    #       overlay_id: "1"
    #       site_id: 1001
    #       site_type:
    #         - "branch"
    #         - "spoke"
    #       port_offset: "1000"
    #       port_hop: true
    #       control_session_pps: "500"
    #       track_transport: true
    #       track_interface_tag: "1"
    #       console_baud_rate: "9600"
    #       max_omp_sessions: "50"
    #       multi_tenant: false
    #       track_default_gateway: false
    #       admin_tech_on_failure: true
    #       enable_tunnel: true
    #       idle_timeout: "300"
    #       on_demand_idle_timeout_min: "60"
    #       tracker:
    #         - name: "tracker1"
    #           endpoint_ip: "203.0.113.1"
    #           endpoint_ip_transport_port: "8080"
    #           protocol: "tcp"
    #           port: "443"
    #           elements:
    #             - "element1, element2"
    #           boolean: "and"
    #           threshold: "10"
    #           interval: "30"
    #           multiplier: "3"
    #           type: "static-route"
    #       object_track:
    #         - object_number: 10
    #           interface: 'GigabitEthernet0/0/0'
    #           sig: '100'
    #           ip: '192.0.2.1'
    #           mask: '255.255.255.0'
    #           vpn: 1
    #           object:
    #             - number: 101
    #           boolean: 'and'
    #         - object_number: 20
    #           interface: 'GigabitEthernet0/0/0'
    #           sig: '100'
    #           ip: '192.0.2.1'
    #           mask: '255.255.255.0'
    #           vpn: 1
    #           object:
    #             - number: 101
    #           boolean: 'and'
    #         - object_number: 30
    #           interface: 'GigabitEthernet0/0/1'
    #           sig: '200'
    #           ip: '198.51.100.1'
    #           mask: '255.255.255.0'
    #           vpn: 2
    #           object:
    #             - number: 201
    #           boolean: 'or'
    #       preference:
    #         - 1
    #       preference_auto: true
    #       epfr: "conservative"
    #       vrf:
    #         - vrf_id: 1
    #           gateway_preference:
    #             - 4 
    #             - 5
    #         - vrf_id: 2
    #           gateway_preference:
    #             - 12
    #             - 13
    #       enable_management_region: true
    #       migration_bgp_community: 65535
    #       enable_mrf_migration: enabled
    #       transport_gateway: true
    #       affinity_group_number: 1
    #       affinity_per_vrf:
    #         - affinity_group_number: 1
    #           vrf_range: "22"
    #       role: "edge-router"
    #       # secondary_region: 55
    #       # region_id: 44
    #     manager_credentials:
    #       <<: *manager_authentication

    - name: "Create Comprehensive Cisco VPN Interface Template"
      cisco.catalystwan.feature_templates:
        state: present
        template_name: "ComprehensiveCiscoVPNInterfaceTemplate"
        template_description: "Cisco VPN Interface template"
        device_specific_variables:
          ipv4_address: ipv4_address_variable
        debug: true
        device_models:
          - "vedge-C8000V"
        cisco_vpn_interface:
          if_name: "GigabitEthernet4"
          interface_description: "Service or Lan Net interface"
          poe: true
          ipv4_address: device_specific_variable
        manager_credentials:
          <<: *manager_authentication

    # # Example of devices specific variables - this works in Feature Templates, need to check Device Templates
    # - name: Create Cisco Banner Feature Template
    #   cisco.catalystwan.feature_templates:
    #     state: present
    #     template_name: "CiscoBannerConfigTemplate"
    #     template_description: "Banner configuration for login and MOTD"
    #     debug: true
    #     device_specific_variables:
    #       login_banner: "var_name_1"
    #       motd_banner: "var_name_2"
    #     device_models:
    #       - "vedge-C8000V"
    #     cisco_banner:
    #       login_banner: device_specific_variable
    #       motd_banner: device_specific_variable
    #     manager_credentials:
    #       <<: *manager_authentication
